// Cargar fechas no disponibles del LocalStorage, si existen
const unavailableDates = JSON.parse(localStorage.getItem('unavailableDates')) || {};

// Función para actualizar las franjas horarias disponibles
function updateTimeSlots() {
    const selectedDate = document.getElementById('date').value;
    const timeSlotsContainer = document.getElementById('timeSlotsContainer');

    if (!selectedDate) {
        timeSlotsContainer.innerHTML = ''; // Limpiar el contenedor si no hay fecha seleccionada
        document.getElementById('price').value = ''; // Limpiar el precio
        return;
    }

    const timeSlots = ['mañana', 'tarde', 'todo'];
    let html = '<label>Selecciona la franja horaria:</label>';

    timeSlots.forEach(slot => {
        const isUnavailable = unavailableDates[selectedDate] && unavailableDates[selectedDate].includes(slot);
        html += `
            <div class="form-check">
                <input class="form-check-input ${isUnavailable ? 'disabled' : ''}" type="radio" name="timeSlot" id="${slot}" value="${slot}" ${isUnavailable ? 'disabled' : ''}>
                <label class="form-check-label ${isUnavailable ? 'disabled' : ''}" for="${slot}">
                    ${slot.charAt(0).toUpperCase() + slot.slice(1)}
                </label>
            </div>
        `;
    });

    timeSlotsContainer.innerHTML = html;
}

// Función para manejar el cambio de fecha
function onDateChange() {
    const selectedDate = document.getElementById('date').value;
    const timeSlot = document.querySelector('input[name="timeSlot"]:checked')?.value;

    updateTimeSlots(); // Actualiza las franjas horarias disponibles

    if (selectedDate && timeSlot) {
        // Verificar si la franja horaria está disponible para la fecha seleccionada
        if (unavailableDates[selectedDate] && unavailableDates[selectedDate].includes(timeSlot)) {
            alert("La franja horaria seleccionada no está disponible.");
            document.getElementById('price').value = "";
            return;
        }

        const price = calculatePrice(selectedDate, timeSlot);
        document.getElementById('price').value = price ? `${price} euros` : "";
    }
}

// Actualiza el contenedor de franjas horarias cuando cambia la fecha
document.getElementById('date').addEventListener('change', function() {
    updateTimeSlots();
    onDateChange();
});

// Actualiza el precio cuando cambia la franja horaria
document.getElementById('timeSlotsContainer').addEventListener('change', function() {
    onDateChange();
});
